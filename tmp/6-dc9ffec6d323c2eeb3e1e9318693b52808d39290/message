refactor some code

Co-authored-by: Torben Wynne <torben@dsbeg.com>

